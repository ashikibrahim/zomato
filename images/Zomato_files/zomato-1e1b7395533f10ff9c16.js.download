"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[4791],{dg7M:(e,n,t)=>{var o,a,i,c,s,r;t.d(n,{Z:()=>U});const l="IFRAME",d=()=>{_(),a()};var u=void 0;let h=void 0;const p=(e,n)=>{var t=document.createElement("iframe");if(t.setAttribute("id","auth-login-ui"),t.setAttribute("src",n),t.setAttribute("sandbox","allow-top-navigation allow-scripts allow-popups allow-forms allow-same-origin"),t.style.alignItems="center",t.style.position="fixed",h=document.createElement("div"),u=t,"MODAL_TYPE_VISIBLE"===e){t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.border="0",t.style.borderRadius="0.6rem",t.style.width="100vw",t.style.height="100vh",t.style.minHeight="150px",t.style.minWidth="300px",t.style.boxShadow="rgba(28, 28, 28, 0.15) 0px 1.2rem 7rem";var o=document.createElement("div");o.style.width="100%",o.style.height="100%",o.style.position="absolute",o.style.opacity="0.8",o.style.top="0px",o.style.backgroundColor="black",o.onclick=d,h.style.width="100%",h.style.height="100%",h.style.border="100%",h.style.position="fixed",h.style.top=0,h.appendChild(o)}else t.style.width="0",t.style.height="0",t.style.visibility="hidden";h.appendChild(u),document.body.appendChild(h)},_=()=>{void 0!==h&&(h.remove(),h=void 0),void 0!==u.close&&u.close()};class m{constructor(){if(m._instance)return m._instance;m._instance=this,this.cookie_domain=process.env.REACT_APP_COOKIE_DOMAIN,this.accounts_domain=process.env.REACT_APP_ACCOUNTS_DOMAIN,this.google_cid="",this.accounts_data={LOGIN_TYPE:"login",LOGIN_METHODS:["google","email","phone"]}}setOAuthScreen(e){this.oauth_screen=e}setIdToken(e){this.id_token=e}setAccountsData(e,n){var t=["google","email","phone"];if("LOGIN_METHODS"==e){if(!Array.isArray(n))return;var o=[];for(const e of n)t.includes(e)&&o.push(e);0==o.length&&(o=["google","email","phone"]),this.accounts_data.LOGIN_METHODS=o}else this.accounts_data[e]=n}setLoginChallenge(e){this.login_challenge=e}setPnlHash(e){this.pnl_hash=e}setTheme(e){this.theme=e}}const g=()=>{var e=new R;e.logout_url&&(document.cookie="cid=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;",fetch(e.logout_url,{method:"POST"}).then(e=>e.json()).then((function(e){e.status})).catch(e=>{}))},f=e=>("; "+document.cookie).split(`; ${e}=`).pop().split(";").shift();function w(){A({ev:"errorFound"})}function y(e){var n=(new m).accounts_domain+"/consent";const t=new FormData;t.append("cc",e),fetch(n,{method:"POST",credentials:"include",body:t}).then(e=>e.json()).then((function(e){1==e.status&&function(e){if(""===e)return!1;try{var n=new m;if(new URL(e).origin!==n.accounts_domain)return!1}catch(e){return!1}return!0}(e.redirect_to)?A({ev:"redirectCallback",data:e.redirect_to}):w()})).catch((function(e){w()}))}function v(){A({ev:"removeCookies"})}function b(){A({ev:"errorFound"})}function P(e,n,t){const o=new FormData;o.append("code",e),o.append("state",n),o.append("scope",t);var a=new R,i=(new m).accounts_domain+"/callback";fetch(i,{method:"POST",credentials:"include",body:o}).then(e=>e.json()).then((function(e){if(e.status)if(e.data.opaque_token){const n=new URLSearchParams;n.append("token",e.data.opaque_token),a.redirect_url&&function(e){if(""===e)return!1;try{var n=new URL(e).origin;if(!/^(https|http):\/\/(.+)?(\.eks\.zdev\.net|\.zdev\.net|\.zomans\.com)$/i.test(n))return!1}catch(e){return!1}return!0}(a.redirect_url)&&fetch(a.redirect_url,{method:"POST",body:n,credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","x-zomato-csrf-token":f("__Host-csrft")}}).then(e=>e.json()).then((function(e){e.status&&v()})).catch(e=>{b()})}else v();else b()})).catch((function(e){b()}))}function k(){var e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,e=>("0"+e.toString(16)).substr(-2)).join("")}async function O(e){var n,t=await function(e){const n=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",n)}(e);return n=t,btoa(String.fromCharCode.apply(null,new Uint8Array(n))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function D(){var e=new m,n=new R;const t=e.accounts_domain+"/oauth2/auth";var o=k(),a=k(),i=await O(a),c=new URL(t);return c.searchParams.append("code_challenge",i),c.searchParams.append("code_challenge_method","S256"),c.searchParams.append("client_id",n.client_id),c.searchParams.append("redirect_uri",e.accounts_domain+"/zoauth/callback"),c.searchParams.append("scope",n.scope),c.searchParams.append("state",o),c.searchParams.append("response_type",n.response_type),e.setAccountsData("zxcv",a),e.setAccountsData("purl",top.window.location.origin),e.setAccountsData("cid",n.client_id),e.setAccountsData("curl",n.redirect_url),function(e){var n=new R,t=new m,o=new Date,a="; expires="+new Date(o.getFullYear()+1,o.getMonth(),o.getDate()).toUTCString();n.redirect_url?document.cookie="cid="+(e||"")+a+";path=/":document.cookie="cid="+(e||"")+a+";domain="+t.cookie_domain+";path=/"}(n.client_id),c.href}function T(e,n){return new Promise(async(t,i)=>{let c=await D();o=t,function(e){a=e}(i),"NEW_WINDOW"===e?(e=>{u=window.open(e);let n=setInterval((function(){u.closed&&(clearInterval(n),d())}),50)})(c):e===l&&p("login_ui"===n?"MODAL_TYPE_VISIBLE":"MODAL_TYPE_HIDDEN",c)})}var S=!1;function A(e){var n=new m;n.oauth_screen==l?document.getElementById("auth-login-ui").contentWindow.postMessage(e,n.accounts_domain):u.postMessage(e,n.accounts_domain)}function E(e){if(e.data&&e.data.ev){var n=new m,t=JSON.parse(JSON.stringify(e.data));if(e.origin===n.accounts_domain)switch(t.ev){case"loginModalReady":S?L():I();break;case"getLoginConfigs":C();break;case"closeModalContainer":o("able to sign in"),_();break;case"errorInSignIn":d();break;case"refreshDone":s();break;case"loggedOut":g(),i();break;case"errorFound":_(),void 0!==c?c("not able to logout"):void 0!==r?r("not able to refresh"):void 0!==a&&a("not able to signin"),S&&(S=!1);break;case"getAccountsData":A({ev:"accountsData",data:(new m).accounts_data});break;case"completeConsent":y(t.data);break;case"completeCallback":P(t.data.code,t.data.state,t.data.scope);break;case"setLoginChallenge":n.setLoginChallenge(t.lc);break;case"completeSignIn":o("able to sign in"),_()}}}const L=()=>{if(!S)return;A({ev:"migrate"})},I=()=>{var e=new m;if(void 0===e.id_token)return;A({ev:"idTokenForOneTap",ID_TOKEN:e.id_token})},C=()=>{A({ev:"themeAndLoginData",THEME:(new m).theme})};function F(){var e=new m;google.accounts.id.initialize({client_id:e.google_cid,callback:j}),google.accounts.id.prompt()}const j=({credential:e=""})=>{var n=new R,t=new m;return t.setIdToken(e),t.setOAuthScreen(l),T(l,"one_tap",n.client_id,n.scope,n.response_type)};function M(){return new Promise((e,n)=>{var t=new R,o=(new m).accounts_domain+"/token/refresh";const a=new FormData;a.append("cid",t.client_id),a.append("callback",t.redirect_url),fetch(o,{method:"POST",credentials:"include",body:a}).then(e=>e.json()).then((function(o){if(o.status)if(o.data.opaque_token){const a=new URLSearchParams;a.append("token",o.data.opaque_token),t.redirect_url&&isValidCallback(t.redirect_url)&&fetch(t.redirect_url,{method:"POST",body:a,credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","x-zomato-csrf-token":f("__Host-csrft")}}).then(e=>e.json()).then((function(t){t.status?e(t.message):n(t.message)})).catch(e=>{n(e)})}else e(o.message);else n(o.message)})).catch((function(e){n(e)}))})}function N(e){var n=f("ttaz");if(n&&1e3*parseInt(n)-Date.now()<36e5)return M()}const x=2,H=4;function W(e){document.getElementById("auth-login-ui").src=e}class R{constructor(e={}){if(R._instance)return R._instance;R._instance=this,this.client_id=e.client_id,this.scope=e.scope||"offline",this.redirect_url=e.redirect_url||"",this.response_type="code",this.refresh_enable=e.refresh_enable||!0;var n,t=new m;void 0!==e.login_methods&&t.setAccountsData("LOGIN_METHODS",e.login_methods),this.logout_url=e.logout_url||"",!0===e.enable_one_tap&&function(){let e=document.createElement("script");e.setAttribute("src","https://accounts.google.com/gsi/client"),e.onload=F,document.body.appendChild(e)}(),void 0!==e.theme&&t.setTheme(e.theme),window.addEventListener("message",E,!1),!0===e.custom&&async function(){var e=new R;(new m).setOAuthScreen(l),T(l,"custom_login",e.client_id,e.scope,e.response_type)}(this.client_id,this.scope,this.response_type),!0===this.auto_refresh&&(N(this.client_id),setInterval(()=>N(this.client_id),18e5)),(n=f("lme"))&&"1"===n&&this.migrate().then(void(document.cookie="lme=; Path=/;Domain=.zdev.net; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"))}validate(){return new Promise((function(e,n){fetch(process.env.REACT_APP_GW_DOMAIN+"/gw/internal/auth/validate",{method:"POST"}).then(n=>{e(n.json())}).catch(e=>{n(e)})}))}login(e=l,n="login_ui"){var t=new m;return[l,"NEW_WINDOW"].includes(e)&&t.setOAuthScreen(e),T(e,n)}logout(){return new Promise((e,n)=>{var t=new R,o=(new m).accounts_domain+"/signout";const a=new FormData;a.append("cid",t.client_id),fetch(o,{method:"POST",credentials:"include",body:a}).then(e=>e.json()).then((function(t){t.status?(g(),e(t.message)):n(t.message)})).catch((function(e){n(e)}))})}refresh(){return M()}migrate(){return e=new R,n=new m,S=!0,n.setOAuthScreen(l),T(l,"migration_flow",e.client_id,e.scope,e.response_type);var e,n}initiatePhoneLogin(e,n,t,o){return function(e,n,t,o){return new Promise((a,i)=>{var c=new m;let s=c.accounts_domain+"/login/phone";const r=new FormData;r.append("country_id",e),r.append("number",n),r.append("lc",c.login_challenge),r.append("type","initiate"),r.append("verification_type",t||"sms"),r.append("message_uuid",o||""),fetch(s,{method:"POST",body:r,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?a(e):i(e)})})}(e,n,t,o)}verifyPhoneLogin(e,n,t){return function(e,n,t){return new Promise((o,a)=>{var i=new m;let c=i.accounts_domain+"/login/phone";const s=new FormData;s.append("country_id",e),s.append("number",n),s.append("lc",i.login_challenge),s.append("type","verify"),s.append("otp",t),fetch(c,{method:"POST",body:s,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?([x,H].includes(e.login_case)?W(e.redirect_to):i.setPnlHash(e.hash),o(e)):a(e)})})}(e,n,t)}signupPhoneLogin(e,n){return function(e,n){return new Promise((t,o)=>{var a=new m;let i=a.accounts_domain+"/login/phone";const c=new FormData;c.append("hash",a.pnl_hash),c.append("lc",a.login_challenge),c.append("type","create_user"),c.append("name",e),c.append("email",n),fetch(i,{method:"POST",body:c,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(W(e.redirect_to),t(e)):o(e)})})}(e,n)}initiateEmailLogin(e){return function(e){return new Promise((n,t)=>{var o=new m;let a=o.accounts_domain+"/login/email";const i=new FormData;i.append("email",e),i.append("lc",o.login_challenge),i.append("type","initiate"),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?n(e):t(e)})})}(e)}verifyEmailLogin(e,n){return function(e,n){return new Promise((t,o)=>{var a=new m;let i=a.accounts_domain+"/login/email";const c=new FormData;c.append("email",e),c.append("lc",a.login_challenge),c.append("type","verify"),c.append("otp",n),fetch(i,{method:"POST",body:c,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(W(e.redirect_to),t(e)):o(e)})})}(e,n)}initiateEmailSignup(e,n){return function(e,n){return new Promise((t,o)=>{var a=new m;let i=a.accounts_domain+"/login/email";const c=new FormData;c.append("name",n),c.append("email",e),c.append("lc",a.login_challenge),c.append("type","signup"),fetch(i,{method:"POST",body:c,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?t(e):o(e)})})}(e,n)}linkPhoneLoginWithEmail(){return new Promise((e,n)=>{var t=new m;let o=t.accounts_domain+"/login/phone";const a=new FormData;a.append("hash",t.pnl_hash),a.append("lc",t.login_challenge),a.append("type","send_login_link"),fetch(o,{method:"POST",body:a,credentials:"include"}).then(e=>e.json()).then(t=>{t.status?e(t):n(t)})})}verifyLinkPhoneLoginWithEmail(e){return function(e){return new Promise((n,t)=>{var o=new m;let a=o.accounts_domain+"/login/phone";const i=new FormData;i.append("hash",o.pnl_hash),i.append("lc",o.login_challenge),i.append("type","verify_otp_link"),i.append("otp",e),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(W(e.redirect_to),n(e)):t(e)})})}(e)}linkPhoneLoginWithGoogle(e){return function(e){return new Promise((n,t)=>{var o=new m;let a=o.accounts_domain+"/login/phone";const i=new FormData;i.append("hash",o.pnl_hash),i.append("lc",o.login_challenge),i.append("type","link"),i.append("id_token",e),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(W(e.redirect_to),n(e)):t(e)})})}(e)}linkPhoneLoginWithFacebook(e){return function(e){return new Promise((n,t)=>{var o=new m;let a=o.accounts_domain+"/login/phone";const i=new FormData;i.append("hash",o.pnl_hash),i.append("lc",o.login_challenge),i.append("type","link"),i.append("fb_token",e),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(W(e.redirect_to),n(e)):t(e)})})}(e)}customGoogleLogin(e){return function(e){return new Promise((n,t)=>{var o=new m;let a=o.accounts_domain+"/login/google";const i=new FormData;i.append("id_token",e),i.append("lc",o.login_challenge),i.append("type","social"),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(W(e.redirect_to),n(e)):t(e)})})}(e)}}const U=function(e){var n;if(null!=(n=e.client_id)&&0!==n.length)return new R(e)}}}]);